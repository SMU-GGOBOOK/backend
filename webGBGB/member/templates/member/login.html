{% extends "iiii.html" %}
{% load static %}
{% block link %}

<link rel="stylesheet" type="text/css" href="{% static 'css/login.css' %}">
{% endblock %}
{% block title %}로그인{% endblock %}
{% block js-block %}

{% if alert %}
  <script>
    alert("{{ alert }}");
  </script>
{% endif %}

{% endblock %}
{% block style-block %}

{% endblock %}
{% block content %}
<div class="feed__content">
            
  <div class="feed__add">
    <div class="feed__add_title">
      <span>로그인</span>
    </div>
    <form method="POST" name="loginFrm">
    {% csrf_token %}
    <div class="login-box">
      <input type="text" class="idpw" name="id" id="id" placeholder="아이디">
      <input type="password" class="idpw" name="pw" id="pw" placeholder="비밀번호">
      
      <div class="checkbox-container">
        <input type="checkbox" class="saveID" name="saveID" id="saveID">
        <p style="color:#1a1a1a; font-weight: 400;">아이디 자동 완성</p>
        <div class="forfind" style="margin-left:155px; display:flex; gap:8px;">
          <a href="/member/find1/" ><p class="ffp">아이디 찾기</p></a>
          <p>|</p>
          <a href="/member/find2/"><p class="ffp">비밀번호 찾기</p></a>
        </div>
      </div>
      
      <button type="submit" class="login-btn" id="loginBtn">로그인</button>

      {% if error %}
        <p style="color: red; font-size: 14px; margin-left:20px;">{{ error }}</p>
      
      {% endif %}

      
    </div>
    </form>
  </div>
</div>

<script>
// 쿠키 설정 함수
function setCookie(name, value, days) {
  const expires = new Date();
  expires.setDate(expires.getDate() + days);
  document.cookie = name + '=' + encodeURIComponent(value) + '; path=/; expires=' + expires.toUTCString();
}

// 쿠키 가져오기 함수
function getCookie(name) {
  const cookies = document.cookie.split(';');
  for (let cookie of cookies) {
    const [key, val] = cookie.trim().split('=');
    if (key === name) return decodeURIComponent(val);
  }
  return '';
}

// 페이지 로드 시 실행
document.addEventListener('DOMContentLoaded', function() {
  const savedId = getCookie('savedUserId');
  const userIdInput = document.getElementById('id');
  const saveIdCheckbox = document.getElementById('saveID');
  const loginForm = document.querySelector('form[name="loginFrm"]');

  // 저장된 아이디가 있으면 입력창에 설정하고 체크박스 체크
  if (savedId) {
    userIdInput.value = savedId;
    saveIdCheckbox.checked = true;
  }

  // 폼 제출 시 쿠키 처리
  loginForm.addEventListener('submit', function(e) {
    const userId = userIdInput.value.trim();

    if (saveIdCheckbox.checked && userId) {
      // 체크박스가 체크되어 있고 아이디가 입력되어 있으면 쿠키에 저장
      setCookie('savedUserId', userId, 7); // 7일 동안 저장
    } else {
      // 체크박스가 체크되지 않았으면 쿠키 삭제
      setCookie('savedUserId', '', -1);
    }
  });

  // 체크박스 상태 변경 시 즉시 쿠키 처리
  saveIdCheckbox.addEventListener('change', function() {
    const userId = userIdInput.value.trim();
    
    if (!this.checked) {
      // 체크박스가 해제되면 쿠키 삭제
      setCookie('savedUserId', '', -1);
    } else if (userId) {
      // 체크박스가 체크되고 아이디가 있으면 쿠키 저장
      setCookie('savedUserId', userId, 7);
    }
  });
});
</script>

{% endblock %}